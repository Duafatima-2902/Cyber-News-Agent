{% extends "base.html" %}

{% block title %}Email Summary - CyberNewsAgent{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="mb-8">
    <h1 class="text-4xl font-bold text-cyber-blue cyber-text-glow mb-2">Email Summary</h1>
    <p class="text-gray-400 text-lg">Ready-to-send cybersecurity digest for your team</p>
    <div class="mt-4">
        <button onclick="copyToClipboard()" class="bg-cyber-blue hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 cyber-glow">
            <i class="fas fa-copy mr-2"></i>Copy to Clipboard
        </button>
        <button onclick="sendEmail()" class="bg-gray-800 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 ml-4">
            <i class="fas fa-envelope mr-2"></i>Send Email
        </button>
    </div>
</div>

<!-- Email Preview -->
<div class="bg-cyber-gray border border-gray-800 rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-bold text-cyber-blue mb-4">
        <i class="fas fa-eye mr-2"></i>Email Preview
    </h2>
    
    <div class="bg-white border border-gray-300 rounded-lg p-6 text-black">
        <!-- Email Header -->
        <div class="border-b border-gray-300 pb-4 mb-4">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold text-gray-800">Subject:</h3>
                <span class="text-sm text-gray-500">2024-09-24</span>
            </div>
            <p class="text-gray-700 font-medium">{{ subject }}</p>
        </div>
        
        <!-- Email Body -->
        <div class="prose prose-sm max-w-none">
            <div class="whitespace-pre-line text-gray-800 leading-relaxed">{{ body }}</div>
        </div>
        
        <!-- Email Footer -->
        <div class="border-t border-gray-300 pt-4 mt-6">
            <div class="flex items-center justify-between text-sm text-gray-500">
                <div>
                    <p>Generated by CyberNewsAgent</p>
                    <p>2024-09-24 18:30:00</p>
                </div>
                <div class="text-right">
                    <p>AI-Powered Cybersecurity Intelligence</p>
                    <p>www.cybernewsagent.com</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Actions -->
<div class="bg-cyber-gray border border-gray-800 rounded-lg p-6 mb-8">
    <h3 class="text-xl font-bold text-cyber-blue mb-4">
        <i class="fas fa-bolt mr-2"></i>Email Actions
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <button onclick="copyToClipboard()" class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg p-4 text-center transition-colors duration-200">
            <i class="fas fa-copy text-cyber-blue text-2xl mb-2"></i>
            <h4 class="font-semibold text-white">Copy Text</h4>
            <p class="text-gray-400 text-sm">Copy email content to clipboard</p>
        </button>
        
        <button onclick="downloadEmail()" class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg p-4 text-center transition-colors duration-200">
            <i class="fas fa-download text-cyber-green text-2xl mb-2"></i>
            <h4 class="font-semibold text-white">Download</h4>
            <p class="text-gray-400 text-sm">Download as text file</p>
        </button>
        
        <button onclick="printEmail()" class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg p-4 text-center transition-colors duration-200">
            <i class="fas fa-print text-cyber-yellow text-2xl mb-2"></i>
            <h4 class="font-semibold text-white">Print</h4>
            <p class="text-gray-400 text-sm">Print email summary</p>
        </button>
    </div>
</div>

<!-- Email Templates -->
<div class="bg-cyber-gray border border-gray-800 rounded-lg p-6">
    <h3 class="text-xl font-bold text-cyber-blue mb-4">
        <i class="fas fa-file-alt mr-2"></i>Email Templates
    </h3>
    <p class="text-gray-400 mb-4">
        Choose from different email templates for different audiences and purposes.
    </p>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-900 border border-gray-700 rounded-lg p-4">
            <h4 class="font-semibold text-white mb-2">Executive Summary</h4>
            <p class="text-gray-400 text-sm mb-3">High-level overview for executives and decision makers</p>
            <button onclick="generateTemplate('executive')" class="bg-cyber-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                Generate Template
            </button>
        </div>
        
        <div class="bg-gray-900 border border-gray-700 rounded-lg p-4">
            <h4 class="font-semibold text-white mb-2">Technical Brief</h4>
            <p class="text-gray-400 text-sm mb-3">Detailed technical analysis for security teams</p>
            <button onclick="generateTemplate('technical')" class="bg-cyber-blue hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                Generate Template
            </button>
        </div>
        
        <div class="bg-gray-900 border border-gray-700 rounded-lg p-4">
            <h4 class="font-semibold text-white mb-2">Incident Alert</h4>
            <p class="text-gray-400 text-sm mb-3">Urgent alerts for immediate action items</p>
            <button onclick="generateTemplate('alert')" class="bg-cyber-red hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                Generate Template
            </button>
        </div>
        
        <div class="bg-gray-900 border border-gray-700 rounded-lg p-4">
            <h4 class="font-semibold text-white mb-2">Weekly Report</h4>
            <p class="text-gray-400 text-sm mb-3">Comprehensive weekly security summary</p>
            <button onclick="generateTemplate('weekly')" class="bg-cyber-green hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                Generate Template
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function copyToClipboard() {
        const emailContent = `Subject: {{ subject }}\n\n{{ body }}`;
        
        navigator.clipboard.writeText(emailContent).then(() => {
            // Show success message
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
            button.classList.add('bg-green-600');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('bg-green-600');
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert('Failed to copy to clipboard');
        });
    }
    
    function sendEmail() {
        const subject = encodeURIComponent('{{ subject }}');
        const body = encodeURIComponent('{{ body }}');
        const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
        
        window.open(mailtoLink);
    }
    
    function downloadEmail() {
        const emailContent = `Subject: {{ subject }}\n\n{{ body }}`;
        const blob = new Blob([emailContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cyber-news-email-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    function printEmail() {
        const printWindow = window.open('', '_blank');
        const emailContent = `
            <html>
                <head>
                    <title>Cybersecurity Email Summary</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { border-bottom: 2px solid #00d4ff; padding-bottom: 10px; margin-bottom: 20px; }
                        .subject { font-weight: bold; color: #333; margin-bottom: 20px; }
                        .content { white-space: pre-line; }
                        .footer { border-top: 1px solid #ccc; padding-top: 10px; margin-top: 20px; font-size: 12px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Cybersecurity Email Summary</h1>
                        <p>Generated: ${new Date().toLocaleString()}</p>
                    </div>
                    <div class="subject">Subject: {{ subject }}</div>
                    <div class="content">{{ body }}</div>
                    <div class="footer">
                        <p>Generated by CyberNewsAgent - AI-Powered Cybersecurity Intelligence</p>
                    </div>
                </body>
            </html>
        `;
        
        printWindow.document.write(emailContent);
        printWindow.document.close();
        printWindow.print();
    }
    
    function generateTemplate(templateType) {
        // Future implementation for generating different email templates
        alert(`${templateType} template generation coming soon`);
    }
</script>
{% endblock %}

